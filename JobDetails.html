<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Job Detail</title>
		<link rel="stylesheet" href="jquery.mobile-1.4.5.css" />
			<script src="jquery-1.11.2.js"></script>
			<script src="jquery.mobile-1.4.5.js"></script>
	</head>
	<body>
		<div data-role="page">
			<div data-role="header" data-add-back-btn="true">
				<h1>Job Detail</h1>			
				<a href="tel:2622936283" data-icon="phone" class="ui-btn-right">Dispatch</a>
			</div><!-- /header -->

			<div role="main" class="ui-content">
				<ul data-role="listview" data-inset="true">
					<li class="ui-field-contain"><label for="0" id="loadId">Load ID - </label></li>
					<li data-role="list-divider">Pickup</li>
					<li class="ui-field-contain"><label for="1">Open Time</label><label id="pickupOpenTime"></label></li>
					<li class="ui-field-contain"><label for="1">Close Time</label><label id="pickupCloseTime"></label></li>
					<li class="ui-field-contain"><label for="3">Pickup At</label><label id="pickupBillingCoName"></label></li>
					<li class="ui-field-contain"><label for="4">Contact</label><label id="pickupBillingContact"></label></li>
					<li data-role="list-divider">Delivery</li>
					<li class="ui-field-contain"><label for="2">Open Time</label><label id="2">3:49 PM</label></li>
					<li class="ui-field-contain"><label for="2a">Close Time</label><label id="2a">4:15 PM</label></li>
					<li class="ui-field-contain"><label for="5">Deliver To</label><label id="5">Standard Express Terminal<br />
					2727 S. 11th St.<br />
					Milwaukee WI 53215</label></li>
					<li class="ui-field-contain"><label for="6">Contact</label><label id="6"></label></li>
					<li class="ui-field-contain"><label for="7">Pieces</label><label id="numberOfPieces"></label></li>
					<li class="ui-field-contain"><label for="8">Weight</label><label id="totalWeight"></label></li>
					<li class="ui-field-contain"><label for="9">Instructions</label><label id="instructionsField"></label></li>
				</ul>
				
				<select id="statusSelection">
					<option value="2">Dispatched</option>
					<option value="3">Confirmed</option>
					<option value="4">At Shipper</option>
					<option value="5">Loaded</option>
					<option value="6">At Delivery</option>
					<option value="7">Delivered</option>
					<option value="8">Drop Trailer</option>
					<option value="10">On Hold</option>					
				</select>

				<a href="#" data-role="button" onclick="SetStatus();">Set Status</a>
			</div><!-- /content -->
			
			<!--<div data-role="footer">
			</div> /footer -->
			<script type="text/javascript">
				function GetJobDetails() {							
					$.ajax({
						type: "GET",
						url: "http://standardexpress.azurewebsites.net/api/MobileLoadDetails/" + 250011,
						success: function(order){
												console.log(order);
												var currentOrder = order.orderDetails[0];
												$('#loadId').append(order.order.OrderId);
												$('#pickupOpenTime').text(currentOrder.AvailableDate);
												$('#pickupCloseTime').text(currentOrder.StopDate);
												$('#pickupBillingCoName').html(order.order.BillingCoName + '<br />' + order.order.BillingAddress+ '<br />' + order.order.BillingCity+ ', ' + order.order.BillingState + ' ' + order.order.BillingZip);
												$('#pickupBillingContact').html(order.order.BillingContact + '<br />' + order.order.BillingPhone);
												$('#numberOfPieces').text(order.order.TotalPieces);
												$('#totalWeight').text(order.order.TotalWeight);
												$('#instructionsField').text(order.order.Notes);
											},
						fail: function(){console.log('error getting job details');alert('error getting job details');}
					});		
				}
				//order details 
				//open goes to available date, then available time
				//close maps to stop date and stop time
				
				function SetStatus(){				
					var selectedStatusId = $("#statusSelection option:selected").val();
					
					if (selectedStatusId == 5){
						$.mobile.changePage("DeliveryConfirmation.html");
					}else if (selectedStatusId == 7 || selectedStatusId == 8){
						$.mobile.changePage("ProofOfDelivery.html");
					}else{
						$.mobile.changePage("HomePage.html");
					}
				}
				
				GetJobDetails();
			</script>
		</div><!-- /page -->
	</body>
</html>